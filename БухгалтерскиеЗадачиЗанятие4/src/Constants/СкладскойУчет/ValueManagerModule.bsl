Процедура ПередЗаписью(Отказ)

	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
				   |	СкладскойУчет.Значение КАК Значение
				   |ИЗ
				   |	Константа.СкладскойУчет КАК СкладскойУчет";

	РезультатЗапроса = Запрос.Выполнить();

	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();

	ВыборкаДетальныеЗаписи.Следующий();

	ДополнительныеСвойства.Вставить("ЗначениеДо", ВыборкаДетальныеЗаписи.Значение);
	
КонецПроцедуры

Процедура ПриЗаписи(Отказ)

	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
				   |	СкладскойУчет.Значение КАК Значение
				   |ИЗ
				   |	Константа.СкладскойУчет КАК СкладскойУчет";

	РезультатЗапроса = Запрос.Выполнить();

	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();

	ВыборкаДетальныеЗаписи.Следующий();

	ДополнительныеСвойства.Вставить("ЗначениеПосле", ВыборкаДетальныеЗаписи.Значение);
	
	Если ДополнительныеСвойства.ЗначениеПосле <> ДополнительныеСвойства.ЗначениеДо Тогда

		ОбновитьПовторноИспользуемыеЗначения();

		Если ДополнительныеСвойства.ЗначениеПосле = Истина Тогда
			ВидСубконто = ПланыВидовХарактеристик.ВидыСубконто.Номенклатура;
		Иначе
			ВидСубконто = ПланыВидовХарактеристик.ВидыСубконто.Склады;
		КонецЕсли;

		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ
					   |	СчетаВидыСубконто.Ссылка КАК Ссылка
					   |ИЗ
					   |	ПланСчетов.Счета.ВидыСубконто КАК СчетаВидыСубконто
					   |ГДЕ
					   |	СчетаВидыСубконто.ВидСубконто = &ВидСубконто";

		Запрос.УстановитьПараметр("ВидСубконто", ВидСубконто);

		РезультатЗапроса = Запрос.Выполнить();

		ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();

		Пока ВыборкаДетальныеЗаписи.Следующий() Цикл

			ПСОбъект = ВыборкаДетальныеЗаписи.Ссылка.ПолучитьОбъект();

			Если ДополнительныеСвойства.ЗначениеПосле = Истина Тогда
				//Добавить
				Если ПСОбъект.ВидыСубконто.Количество() = 2 Тогда

					Продолжить;

				КонецЕсли;

				НоваяСтрока = ПСОбъект.ВидыСубконто.Добавить();
				НоваяСтрока.ВидСубконто = ПланыВидовХарактеристик.ВидыСубконто.Склады;

			Иначе
				//Удалить
				СтрокаДляУдаления = ПСОбъект.ВидыСубконто.Найти(ПланыВидовХарактеристик.ВидыСубконто.Склады,
					"ВидСубконто");

				ПСОбъект.ВидыСубконто.Удалить(СтрокаДляУдаления);

			КонецЕсли;

			ПСОбъект.Записать();

		КонецЦикла;

	КонецЕсли;
КонецПроцедуры